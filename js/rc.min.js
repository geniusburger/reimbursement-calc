var rc={DARK:"#272b30",MID:"#2e3338",LIGHT:"#49515a",LINE:"#3366cc",TEXT:"#c8c8c8"};rc.BACKGROUND=rc.DARK;rc.GRID=rc.LIGHT;
rc.CHART_OPTIONS={pointSize:6,backgroundColor:rc.BACKGROUND,selectionMode:"multiple",animation:{duration:300},series:{color:rc.LINE},tooltip:{textStyle:{color:rc.TEXT}},hAxis:{titleTextStyle:{color:rc.TEXT},textStyle:{color:rc.TEXT},baselineColor:rc.GRID,gridlines:{color:"transparent"}},vAxis:{format:"$#,###",titleTextStyle:{color:rc.TEXT},textStyle:{color:rc.TEXT},baselineColor:rc.GRID,gridlines:{color:rc.GRID}},legend:{position:"none"}};rc.storage=void 0;rc.chart=void 0;
rc.loadDate=function(a,b){a instanceof Array&&2===a.length&&(b=new Currency(a[0]),a=new Date(a[1]));dateRowUtil.add(a,rc.getSelectedTimeAmount(),rc.getSelectedTimeUnit(),b,rc.completeLoadDate)};rc.completeLoadDate=function(){$("#testButton").addClass("hidden");$("#clearButton").removeClass("hidden");rc.drawChart();setTimeout(rc.highlightPoints,1E3)};
rc.updateNextExpiration=function(a){var b=document.getElementById("nextEvent");null===a?b.style.visibility="hidden":(b.style.visibility="visible",document.getElementById("daysLeft").innerHTML=a.days,b=document.querySelector("#nextEvent>div"),b.onmouseover=function(){rc.hoverPointHandler(a)},b.onmouseout=function(){rc.unhoverPointHandler()})};rc.addDate=function(a,b){rc.loadDate(a,b);rc.storage.setDates()};
rc.loadTestData=function(){[["$7802.05","7/6/2012"],["$6931.49","2/1/2013"],["$7568.49","4/12/2013"],["$3802.00","1/6/2012"],["$3658.51","4/13/2012"],["$775.00","12/21/2012"],["$4350.00","6/28/2013"]].forEach(function(a){rc.addDate(a)})};rc.getSelectedTimeAmount=function(){return util.getSelected("timeAmount")};rc.getSelectedTimeUnit=function(){return util.getSelected("timeUnit")};
rc.hoverPointHandler=function(a){rc.lastPoint=a;var b=todayRowUtil.row.tr.rowIndex-2;a.row===b?(rc.setChartSelection([{row:b,column:1}]),rc.colorPoints()):(b=rowUtil.getRows(),b[a.row].row.highlight(!0,!0),rc.highlightPoints(b[a.row].row))};rc.unhoverPointHandler=function(){for(var a=dateRowUtil.getStartRows(),b=0;b<a.length;b++)a[b].row.highlight(!1,!0);rc.setChartSelection();rc.highlightPoints()};rc.selectPointHandler=function(){rc.hoverPointHandler(rc.lastPoint)};
rc.highlightPoints=function(a){var b=todayRowUtil.row,c=b.tr.rowIndex-2;if("undefined"===typeof a||null===a)rc.setChartSelection([{row:c,column:1}]);else{var d=a.isStart()?a:a.matchingRow,e=d.matchingRow,f=d.tr.rowIndex-2,g=e.tr.rowIndex-2;rc.setChartSelection([{row:f,column:1},{row:g,column:1},{row:c,column:1}])}rc.colorPoints(d,e,b,f,g,c)};
rc.colorPoints=function(a,b,c,d,e,f){rc.TODAY_COLOR||(rc.TODAY_COLOR=$(c.tr).children("td").first().css("backgroundColor"));c=$("svg>g>g>g>circle");for(var g=[],h=0;h<c.length;h++)g.push(c[h].outerHTML);var k=1,m=2,l=3,g=4,h=5;6>c.length?rc.setSelectedPointColor(c[0],c[c.length-1],rc.TODAY_COLOR):(6<c.length&&("none"==c[2].getAttribute("fill")?(k+=3,m+=3,l+=3,g+=3,h+=3):"none"==c[4].getAttribute("fill")?(l+=3,g+=3,h+=3):"none"==c[6].getAttribute("fill")&&(h+=3)),f<d?(e=0,d=m,f=l,m=g,l=h):f<e?(d=0,
f=k,e=m,k=l,m=g,l=h):(d=0,f=k,e=g,k=h),rc.START_COLOR||(rc.START_COLOR=$(a.tr).css("backgroundColor")),rc.STOP_COLOR||(rc.STOP_COLOR=$(b.tr).css("backgroundColor")),rc.setSelectedPointColor(c[d],c[f],rc.START_COLOR),rc.setSelectedPointColor(c[m],c[l],rc.STOP_COLOR),rc.setSelectedPointColor(c[e],c[k],rc.TODAY_COLOR))};rc.setChartSelection=function(a){try{rc.chart.setSelection(a)}catch(b){console.warn("Oddity setting selection",b)}};rc.clearChartSelection=function(){rc.setChartSelection()};
rc.setSelectedPointColor=function(a,b,c){$(a).attr("stroke",c);$(b).attr("fill",c)};rc.enterCatch=function(a){13==a.keyCode&&rc.getInput()};
rc.getInput=function(){$("#inputButton").blur();var a=$("#inputDate"),b=$("#inputAmount"),c=new Date(a.val()),d=new Currency(b.val()),e=!0;d.valid?b.parent().removeClass("has-error"):(e=!1,b.parent().addClass("has-error"),b.focus());util.isInvalidDate(c)?(e=!1,a.parent().addClass("has-error"),a.focus()):a.parent().removeClass("has-error");e&&(a.val(""),b.val(""),rc.addDate(c,d),rc.storage.setDates(),rc.drawChart(),a.focus());return!1};
rc.updateReimbursementTime=function(){var a=[];dateRowUtil.getStartRows().forEach(function(b){a.push([b.row.amountCell.toString(),b.row.dateCell.toString()])});dateRowUtil.removeAll();a.forEach(function(a){rc.loadDate(a)})};rc.timeAmountChanged=function(){rc.storage.setTimeAmount(this.selectedOptions[0].value);rc.updateReimbursementTime()};rc.timeUnitChanged=function(){rc.storage.setTimeUnit(this.selectedOptions[0].value);rc.updateReimbursementTime()};
rc.populateTimeAmounts=function(a,b){var c=0;switch(a){case "Days":c=30;break;case "Months":c=12;break;case "Years":c=20;break;default:console.error("Failed to populate time amounts from unit: "+a);return}var d=document.getElementById("timeAmount");util.removeChildren(d);for(var e=1;e<=c;e++){var f=document.createElement("option");f.innerHTML=e;d.appendChild(f)}b>c&&(b=c);d.options[b-1].selected=!0};
rc.drawChart=function(){if(chartIsReady){rc.chart||(rc.chart=new google.visualization.LineChart(document.getElementById("chart")),google.visualization.events.addListener(rc.chart,"select",rc.selectPointHandler),google.visualization.events.addListener(rc.chart,"onmouseover",rc.hoverPointHandler),google.visualization.events.addListener(rc.chart,"onmouseout",rc.unhoverPointHandler));var a=rowUtil.getRows();1>=a.length?rc.$chart.css("visibility","hidden"):rc.$chart.css("visibility","visible");for(var b=
null,c=null,d=[["Date","Owed"]],e=0;e<a.length;e++)if(a[e].row instanceof TodayRow)c=a[e].row;else{if(c){var f=a[e].row,g=b.dateCell.date.getTime(),h=c.dateCell.date.getTime(),k=f.dateCell.date.getTime()-g,g=(h-g)/k,b=b.owedCell.currency.toFloat(),f=f.owedCell.currency.toFloat();d.push(rc.buildDot(c,b+g*(f-b)));c=null}b=a[e].row;d.push(rc.buildDot(b))}c&&d.push(rc.buildDot(c));rc.chart.draw(google.visualization.arrayToDataTable(d),rc.CHART_OPTIONS)}else rc.$chart.css("visibility","hidden"),console.error("Chart not ready")};
rc.buildDot=function(a,b){var c=a.dateCell.date,d=c.toString().split(" ")[1]+" "+c.getDate()+", "+c.getFullYear();b=b||a.owedCell.currency.toFloat();return[{v:c,f:d},{v:b,f:a.owedCell.currency.toString()}]};
rc.checkOverflow=function(){var a=rc.$column.width();if(rc.lastColWidth!==a){rc.lastColWidth=a;rc.$chart.css({width:a+"px",height:a+"px"});rc.drawChart();var b=rc.$table.width()>a;rc.widthWhenChangingSmallSize?a!=rc.widthWhenChangingSmallSize&&cellUtil.setSmallSize(b)&&(rc.widthWhenChangingSmallSize=a):cellUtil.setSmallSize(b)&&(rc.widthWhenChangingSmallSize=a)}};window.onload=function(){rc.storage=new StorageManager;var a=new PageViewModel;ko.applyBindings(a);a.loadTestData()};
