var rc={DARK:"#272b30",MID:"#2e3338",LIGHT:"#49515a",LINE:"#3366cc",TEXT:"#c8c8c8"};rc.BACKGROUND=rc.DARK;rc.GRID=rc.LIGHT;
rc.CHART_OPTIONS={pointSize:6,backgroundColor:rc.BACKGROUND,selectionMode:"multiple",animation:{duration:300},series:{color:rc.LINE},tooltip:{textStyle:{color:rc.TEXT}},hAxis:{titleTextStyle:{color:rc.TEXT},textStyle:{color:rc.TEXT},baselineColor:rc.GRID,gridlines:{color:"transparent"}},vAxis:{format:"$#,###",titleTextStyle:{color:rc.TEXT},textStyle:{color:rc.TEXT},baselineColor:rc.GRID,gridlines:{color:rc.GRID}},legend:{position:"none"}};rc.storage=void 0;rc.chart=void 0;
rc.completeLoadDate=function(){rc.drawChart();setTimeout(rc.highlightPoints,1E3)};rc.hoverPointHandler=function(a){rc.lastPoint=a;var c=rc.viewModel.rows.indexOf(rc.viewModel.todayRow);a.row===c?(rc.setChartSelection([{row:c,column:1}]),rc.colorPoints()):(a=rc.viewModel.rows()[a.row],rc.viewModel.highlight(a,!0),rc.highlightPoints(a))};rc.unhoverPointHandler=function(){rc.viewModel.rows().forEach(function(a){rc.viewModel.highlight(a,!1)});rc.setChartSelection();rc.highlightPoints()};
rc.selectPointHandler=function(){rc.hoverPointHandler(rc.lastPoint)};rc.highlightPoints=function(a){var c=rc.viewModel.todayRow,b=rc.viewModel.rows.indexOf(c);if("undefined"===typeof a||null===a)rc.setChartSelection([{row:b,column:1}]);else{var e=a.isStart?a:a.matchingRow,d=e.matchingRow,g=rc.viewModel.rows.indexOf(e),f=rc.viewModel.rows.indexOf(d);rc.setChartSelection([{row:g,column:1},{row:f,column:1},{row:b,column:1}])}rc.colorPoints(e,d,c,g,f,b)};
rc.colorPoints=function(a,c,b,e,d,g){rc.TODAY_COLOR||(rc.TODAY_COLOR=rc.$table.find(".active").children("td").first().css("backgroundColor"));a=$("svg>g>g>g>circle");c=[];for(b=0;b<a.length;b++)c.push(a[b].outerHTML);var f=1,k=2,h=3;c=4;b=5;6>a.length?rc.setSelectedPointColor(a[0],a[a.length-1],rc.TODAY_COLOR):(6<a.length&&("none"==a[2].getAttribute("fill")?(f+=3,k+=3,h+=3,c+=3,b+=3):"none"==a[4].getAttribute("fill")?(h+=3,c+=3,b+=3):"none"==a[6].getAttribute("fill")&&(b+=3)),g<e?(d=0,e=k,g=h,k=c,
h=b):g<d?(e=0,g=f,d=k,f=h,k=c,h=b):(e=0,g=f,d=c,f=b),rc.START_COLOR||(rc.START_COLOR=rc.$table.find(".tr.start.highlight").first().css("backgroundColor"),console.log("found start color: "+rc.START_COLOR)),rc.STOP_COLOR||(rc.STOP_COLOR=rc.$table.find(".tr.stop.highlight").first().css("backgroundColor"),console.log("found stop color: "+rc.STOP_COLOR)),rc.setSelectedPointColor(a[e],a[g],rc.START_COLOR),rc.setSelectedPointColor(a[k],a[h],rc.STOP_COLOR),rc.setSelectedPointColor(a[d],a[f],rc.TODAY_COLOR))};
rc.setChartSelection=function(a){try{rc.chart.setSelection(a)}catch(c){console.warn("Oddity setting selection",c)}};rc.clearChartSelection=function(){rc.setChartSelection()};rc.setSelectedPointColor=function(a,c,b){$(a).attr("stroke",b);$(c).attr("fill",b)};
rc.drawChart=function(){if(chartIsReady){rc.chart||(rc.chart=new google.visualization.LineChart(document.getElementById("chart")),google.visualization.events.addListener(rc.chart,"select",rc.selectPointHandler),google.visualization.events.addListener(rc.chart,"onmouseover",rc.hoverPointHandler),google.visualization.events.addListener(rc.chart,"onmouseout",rc.unhoverPointHandler));var a=rc.viewModel.rows();1>=a.length?rc.$chart.css("visibility","hidden"):rc.$chart.css("visibility","visible");for(var c=
null,b=null,e=[["Date","Owed"]],d=0;d<a.length;d++)if(a[d].isToday)b=a[d];else{if(b){var g=a[d],f=c.date.getTime(),k=b.date.getTime(),h=g.date.getTime()-f,f=(k-f)/h,c=c.owed().toFloat(),g=g.owed().toFloat();e.push(rc.buildDot(b,c+f*(g-c)));b=null}c=a[d];e.push(rc.buildDot(c))}b&&e.push(rc.buildDot(b));rc.chart.draw(google.visualization.arrayToDataTable(e),rc.CHART_OPTIONS)}else rc.$chart.css("visibility","hidden"),console.error("Chart not ready")};
rc.buildDot=function(a,c){var b=a.date,e=b.toString().split(" ")[1]+" "+b.getDate()+", "+b.getFullYear();c=c||a.owed().toFloat();var d=a.owed().toString();return[{v:b,f:e},{v:c,f:d}]};rc.checkOverflow=function(){var a=rc.$column.width();rc.lastColWidth!==a&&(rc.lastColWidth=a,rc.$chart.css({width:a+"px",height:a+"px"}),rc.drawChart(),rc.largeTableWidth||(rc.largeTableWidth=rc.$table.width()),rc.viewModel.isSmall(rc.largeTableWidth>a))};
window.onload=function(){rc.storage=new StorageManager;rc.viewModel=new PageViewModel(rc.storage);ko.applyBindings(rc.viewModel);rc.viewModel.loadSavedData();rc.$table=$("#dateTable");rc.$column=rc.$table.parent();rc.$chart=$("#chart");rc.checkOverflow();$(window).resize(rc.checkOverflow)};
