function Reimbursement(a,b){if(this.amount=b,this.amountString=b,this.startDate=new Date(a),this.isValid()===!0){this.stopDate=new Date(this.startDate);var c=Number(rc.getSelectedTimeAmount());switch(rc.getSelectedTimeUnit()){case"Days":this.stopDate.setDate(this.stopDate.getDate()+c);break;case"Months":this.stopDate.setMonth(this.stopDate.getMonth()+c);break;default:console.log("Failed to find time unit, defaulting to years");case"Years":this.stopDate.setFullYear(this.stopDate.getFullYear()+c)}this.dollars=parseInt(b);var d=b.indexOf(".");if(-1===d)this.cents=0;else{var e=b.substring(b.indexOf(".")+1);2===e.length?this.cents=parseInt(e):startDate=0/0}this.amount=100*this.dollars+this.cents}}function ReimbursementEvent(a,b,c){this.reimbursement=a,this.index=b,this.start=c}Reimbursement.prototype.isValid=function(){return this.isValidDate()&&this.isValidAmount()},Reimbursement.prototype.isInvalid=function(){return this.isInvalidDate()||this.isInvalidAmount()},Reimbursement.prototype.isInvalidDate=function(){return isNaN(this.startDate.getTime())},Reimbursement.prototype.isValidDate=function(){return!this.isInvalidDate()},Reimbursement.prototype.isInvalidAmount=function(){return!this.isValidAmount()},Reimbursement.prototype.isValidAmount=function(){var a=this.amountString.match(/^\s*\d+(\.\d\d)?\s*$/);return null===a||0===a.length?!1:!isNaN(parseFloat(this.amountString))&&isFinite(this.amountString)&&parseFloat(this.amountString)>=0},Reimbursement.prototype.toString=function(){return this.amountString+"@"+this.startDate.toDateString()},ReimbursementEvent.prototype.isStart=function(){return this.start},ReimbursementEvent.prototype.isStop=function(){return!this.start},ReimbursementEvent.prototype.getAmount=function(){return this.reimbursement.amount},ReimbursementEvent.prototype.getDate=function(){return this.start?this.reimbursement.startDate:this.reimbursement.stopDate},ReimbursementEvent.prototype.getAmountString=function(){return"$"+this.reimbursement.dollars+"."+(this.reimbursement.cents<10?"0":"")+this.reimbursement.cents},ReimbursementEvent.prototype.toString=function(){return(this.start?"+ ":"- ")+this.getDate().toDateString()+" : "+this.getAmountString()};var util={};util.getCookie=function(a){for(var a=a+"=",b=document.cookie.split(";"),c=0;c<b.length;c++){var d=b[c].trim();if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null},util.setCookie=function(a,b){document.cookie=a+"="+b},util.removeChildren=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},util.getNumberWithCommas=function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};var rc={};rc.DATE_START_TEXT="Reimbursed",rc.DATE_STOP_TEXT="Obligation Expired",rc.TODAY_TEXT="Today",rc.DARK="#272b30",rc.MID="#2e3338",rc.LIGHT="#49515a",rc.LINE="#3366cc",rc.TEXT="#c8c8c8",rc.BACKGROUND=rc.DARK,rc.GRID=rc.LIGHT,rc.CHART_OPTIONS={pointSize:6,backgroundColor:rc.BACKGROUND,selectionMode:"multiple",animation:{duration:1e3},series:{color:rc.LINE},tooltip:{textStyle:{color:rc.TEXT}},hAxis:{titleTextStyle:{color:rc.TEXT},textStyle:{color:rc.TEXT},baselineColor:rc.GRID,gridlines:{color:"transparent"}},vAxis:{format:"$#,###",titleTextStyle:{color:rc.TEXT},textStyle:{color:rc.TEXT},baselineColor:rc.GRID,gridlines:{color:rc.GRID}},legend:{position:"none"}},rc.reimbursements=[],rc.reimbursementEvents=[],rc.runningAmount=[],rc.chartData=[],rc.chart=void 0,rc.selection=[],rc.chartColor,rc.addDate=function(a){return a.isValid()&&(rc.reimbursements[rc.reimbursements.length]=a),a.isValid()},rc.removeDate=function(){rc.removeAt(this.dateIndex)},rc.removeAt=function(a){rc.reimbursements.splice(a,1),rc.processReimbursements()},rc.clearDates=function(){rc.reimbursements=[],rc.processReimbursements()},rc.loadTestData=function(){rc.addDate(new Reimbursement("7/6/2012","7802.05")),rc.addDate(new Reimbursement("2/1/2013","6931.49")),rc.addDate(new Reimbursement("4/12/2013","7568.49")),rc.addDate(new Reimbursement("1/6/2012","3802.00")),rc.addDate(new Reimbursement("4/13/2012","3658.51")),rc.addDate(new Reimbursement("12/21/2012","775.00")),rc.addDate(new Reimbursement("6/28/2013","4350.00")),rc.processReimbursements()},rc.getSelectedTimeAmount=function(){return rc.getSelected("timeAmount")},rc.getSelectedTimeUnit=function(){return rc.getSelected("timeUnit")},rc.getSelected=function(a){return document.getElementById(a).selectedOptions[0].value},rc.sortByDate=function(a,b){return a.getDate()-b.getDate()},rc.processReimbursements=function(){var a=null;rc.reimbursementEvents=[],rc.runningAmount=[];for(var b=0;b<rc.reimbursements.length;b++)rc.reimbursementEvents[rc.reimbursementEvents.length]=new ReimbursementEvent(rc.reimbursements[b],b,!0),rc.reimbursementEvents[rc.reimbursementEvents.length]=new ReimbursementEvent(rc.reimbursements[b],b,!1),null===a?a="":a+=":",a+=rc.reimbursements[b];rc.reimbursementEvents.sort(rc.sortByDate);for(var c=0,b=0;b<rc.reimbursementEvents.length;b++)rc.reimbursementEvents[b].isStart()?c+=rc.reimbursementEvents[b].getAmount():c-=rc.reimbursementEvents[b].getAmount(),rc.runningAmount[b]=c;util.setCookie("dates",a),rc.print()},rc.print=function(){var a=document.getElementById("tableBody");util.removeChildren(a);for(var b=0,c=(new Date).getTime(),d=!1,e=0;e<rc.reimbursementEvents.length;e++)!d&&c>b&&c<=rc.reimbursementEvents[e].getDate().getTime()&&(a.appendChild(rc.buildTodayRow(0===e?0:rc.runningAmount[e-1])),d=!0),a.appendChild(rc.buildDateTableRow(rc.reimbursementEvents[e],rc.runningAmount[e],e));!d&&rc.reimbursementEvents.length>1&&a.appendChild(rc.buildTodayRow(0)),rc.reimbursementEvents.length>1?($("#testButton").addClass("hidden"),$("#clearButton").removeClass("hidden")):($("#testButton").removeClass("hidden"),$("#clearButton").addClass("hidden")),rc.drawChart()},rc.buildTodayRow=function(a){var b=document.createElement("tr");return b.className="active",b.appendChild(rc.buildTableCellText(rc.TODAY_TEXT,"bold|center")),b.appendChild(rc.buildTableCellText("")),b.appendChild(rc.buildTableCellText("")),b.appendChild(rc.buildTableCellText("$"+rc.getDollarsStringFromCents(a),"bold|right")),b.appendChild(rc.buildTableCellText("")),b},rc.getDollarsStringFromCents=function(a,b){var c=a%100,d=parseInt(a/100);return b&&(d=util.getNumberWithCommas(d)),d+"."+(10>c?"0":"")+c},rc.buildDateListItem=function(a,b,c){var d=document.createElement("li");d.className="list-group-item list-group-item-",d.className+=0===c?"danger":0===b?"success":a.isStart()===!0?"warning":"info";var e=document.createElement("button");return e.type="button",e.className="close",e.setAttribute("data-dismiss","alert"),e.setAttribute("aria-hidden","true"),e.innerHTML="&times;",$(e).on("click",null,function(){rc.removeAt(a.index)}),d.appendChild(e),d.appendChild(document.createTextNode(a+" $"+rc.getDollarsStringFromCents(b))),d},rc.buildDateTableRow=function(a,b,c){var d=document.createElement("tr");return d.appendChild(rc.buildTableCellText(a.getDate().toDateString(),"right")),d.appendChild(rc.buildTableCellText(a.isStart()?rc.DATE_START_TEXT:rc.DATE_STOP_TEXT,"center")),d.appendChild(rc.buildTableCellText(a.getAmountString(),"right")),d.appendChild(rc.buildTableCellText("$"+rc.getDollarsStringFromCents(b),"right")),d.appendChild(rc.buildTableCellButton(a.index)),d.dateIndex=a.index,d.eventIndex=c,d.onmouseover=rc.hoverRowHandler,d.onmouseout=rc.unhoverRowHandler,d},rc.buildTableCellText=function(a,b){var c=document.createElement("td"),d=document.createTextNode(a);if(void 0===b&&(b=""),b.match(/bold/)){var e=document.createElement("strong");e.appendChild(d),d=e}return b.match(/right/)&&(c.className="text-right"),b.match(/center/)&&(c.className="text-center"),c.appendChild(d),c},rc.buildTableCellButton=function(a){var b=document.createElement("td"),c=document.createElement("button");return c.type="button",c.className="close",c.setAttribute("aria-hidden","true"),c.innerHTML="&times;",c.dateIndex=a,$(c).on("click",null,rc.removeDate),b.appendChild(c),b},rc.hoverRowHandler=function(){rc.highlightRows(this.dateIndex)},rc.unhoverRowHandler=function(){rc.chart.setSelection(),rc.unhighlightRows()},rc.hoverPointHandler=function(a){rc.lastPoint=a,rc.highlightRows(rc.reimbursementEvents[a.row].index)},rc.unhoverPointHandler=function(){rc.unhighlightRows()},rc.selectPointHandler=function(){rc.highlightRows(rc.reimbursementEvents[rc.lastPoint.row].index)},rc.highlightRows=function(a){rc.selection=[];var b=!0;$("#tableBody").children("tr").each(function(c,d){d.dateIndex===a?(b===!0?(b=!1,$(d).addClass("danger"),rc.RED||(rc.RED=$(d).find("td").first().css("backgroundColor"))):($(d).addClass("success"),rc.GREEN||(rc.GREEN=$(d).find("td").first().css("backgroundColor"))),rc.selection.push({row:this.eventIndex,column:1})):($(d).removeClass("danger"),$(d).removeClass("success"))}),rc.chart.setSelection(rc.selection);for(var c=$("svg>g>g>g>circle"),d=[],e=0;e<c.length;e++)d.push(c[e].outerHTML);var f=0,g=1,h=2,i=3;c.length>4&&("none"==c[4].getAttribute("stroke")&&(g=4,h=5),i=6),rc.setSelectedPointColor(c[f],c[g],rc.RED),rc.setSelectedPointColor(c[h],c[i],rc.GREEN)},rc.setSelectedPointColor=function(a,b,c){$(a).attr("stroke",c),$(b).attr("fill",c)},rc.unhighlightRows=function(){$("#tableBody").children("tr").removeClass("danger").removeClass("success")},rc.enterCatch=function(a){13==a.keyCode&&rc.getInput()},rc.getInput=function(){$("#inputButton").blur();var a=$("#inputDate"),b=$("#inputAmount"),c=new Reimbursement(a.val(),b.val());return rc.addDate(c)===!0&&(a.val(""),b.val(""),rc.processReimbursements(),a.focus()),c.isInvalidAmount()?(b.parent().addClass("has-error"),b.focus()):b.parent().removeClass("has-error"),c.isInvalidDate()?(a.parent().addClass("has-error"),a.focus()):a.parent().removeClass("has-error"),!1},rc.updateReimbursementTime=function(){for(var a=0;a<rc.reimbursements.length;a++){var b=rc.reimbursements[a];rc.reimbursements[a]=new Reimbursement(b.startDate,b.amountString)}},rc.timeAmountChanged=function(){util.setCookie("timeAmount",this.selectedOptions[0].value),rc.updateReimbursementTime(),rc.processReimbursements()},rc.timeUnitChanged=function(){var a=this.selectedOptions[0].value;util.setCookie("timeUnit",a),rc.populateTimeAmounts(a,rc.getSelectedTimeAmount()),rc.updateReimbursementTime(),rc.processReimbursements()},rc.populateTimeAmounts=function(a,b){switch(a){case"Days":var c=30;break;case"Months":var c=12;break;case"Years":var c=20;break;default:return console.log("Failed to populate time amounts from unit: "+a),void 0}var d=document.getElementById("timeAmount");util.removeChildren(d);for(var e=1;c>=e;e++){var f=document.createElement("option");f.innerHTML=e,d.appendChild(f)}b>c&&(b=c),d.options[b-1].selected=!0},rc.drawChart=function(){if(chartIsReady)if(rc.chart||(rc.chart=new google.visualization.LineChart(document.getElementById("chart")),google.visualization.events.addListener(rc.chart,"select",rc.selectPointHandler),google.visualization.events.addListener(rc.chart,"onmouseover",rc.hoverPointHandler),google.visualization.events.addListener(rc.chart,"onmouseout",rc.unhoverPointHandler)),0===rc.reimbursementEvents.length)$("#chart").addClass("hidden");else{$("#chart").removeClass("hidden"),rc.chartData=[],rc.chartData[0]=["Date","Owed"];for(var a=0;a<rc.reimbursementEvents.length;a++)rc.chartData[a+1]=[rc.reimbursementEvents[a].getDate(),{v:rc.runningAmount[a]/100,f:"$"+rc.getDollarsStringFromCents(rc.runningAmount[a],!0)}];var b=google.visualization.arrayToDataTable(rc.chartData);rc.chart.draw(b,rc.CHART_OPTIONS)}else $("#chart").addClass("hidden"),console.error("Chart not ready")},window.onload=function(){if($("#inputButton").on("click",null,rc.getInput),$("#testButton").on("click",null,rc.loadTestData),$("#clearButton").on("click",null,rc.clearDates),$("#inputAmount").keypress(rc.enterCatch),$("#inputDate").keypress(rc.enterCatch),rc.populateTimeAmounts("Years",2),"file:"===window.location.protocol)rc.loadTestData();else{navigator.cookieEnabled!==!0&&$("#cookieAlert").removeClass("hidden");var a=util.getCookie("timeAmount"),b=util.getCookie("timeUnit");null!==a&&null!==b&&""!==a&&""!==b&&($("#timeUnit").val(b),rc.populateTimeAmounts(b,a));var c=util.getCookie("dates");if(null!==c&&""!==c)for(var d=c.split(":"),e=0;e<d.length;e++){var f=d[e].split("@");rc.addDate(new Reimbursement(f[1],f[0]))}}$("#timeAmount").on("change",null,rc.timeAmountChanged),$("#timeUnit").on("change",null,rc.timeUnitChanged),rc.processReimbursements()};