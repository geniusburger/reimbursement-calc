function PageViewModel(c,f){var a=this;a.storage=c;a.highlightPoints=f;a.updateChart=null;a.date=ko.observable();a.dateError=ko.observable(!1);a.amount=ko.observable();a.amountError=ko.observable(!1);a.timeAmount=ko.observable(c.getTimeAmount()||2);a.lastTimeAmount=1;a.timeUnit=ko.observable(c.getTimeUnit()||"Years");a.rows=ko.observableArray();a.isSmall=ko.observable(!1);a.daysLeft=ko.observable(0);a.dateFocus=ko.observable(!0);a.amountFocus=ko.observable(!1);a.nextRow=null;a.loading=!0;a.timeUnitOptions=
["Days","Months","Years"];a.sizeRow=new RowViewModel(new Date(0),new Currency("0"),!1,a.isSmall,"SizeRow");a.todayRow=new RowViewModel(new Date,new Currency("0"),!1,a.isSmall,"Today");a.rows.push(a.todayRow);a.timeAmountOptions=ko.computed(function(){var a=this.timeUnit(),e=this.timeAmount.peek(),d=0;switch(a){case "Days":d=30;break;case "Months":d=12;break;case "Years":d=20;break;default:console.error("Failed to populate time amounts from unit: "+this.timeUnit());return}e>d&&(e=d);this.timeAmount(e);
a=[];for(e=1;e<=d;e++)a.push(e);return a},this);a.removePair=function(b){a.rows.removeAll([b,b.matchingRow])};a.rows.subscribe(function(b){var e=new Currency("0");b.forEach(function(a){a.update(e)});a.loading||a.storage.setDates(b);var d=a.rows.indexOf(a.todayRow);if(-1!==d&&d<a.rows().length-1){a.nextRow=a.rows()[d+1];var d=util.stripTime(a.nextRow.date),c=util.stripTime(a.todayRow.date),d=(d-c)/864E5,c=Math.floor(d);if(c!==d)var f=Math.ceil(d),d=f-d<d-c?f:c;a.daysLeft(d)}else a.daysLeft(0);b.length%
2&&a.updateChart&&a.updateChart()});a.updateDuration=function(){var b=[];a.rows().forEach(function(a){a.isStart&&b.push({date:a.date,amount:a.amount})});a.deleteAll();b.forEach(function(b){a.addDate(b.date,b.amount,!0)});a.rows.valueHasMutated();a.highlightPoints()};a.timeAmount.subscribe(a.updateDuration);a.timeUnit.subscribe(a.updateDuration);a.deleteAll=function(){a.rows.remove(function(a){return!a.isToday})};a.getInput=function(){var b=new Date(a.date()),c=new Currency(a.amount()),d=!0;c.valid||
(d=!1,a.amountFocus(!0));a.amountError(!c.valid);util.isInvalidDate(b)?(d=!1,a.dateError(!0),a.dateFocus(!0)):a.dateError(!1);d&&(a.date(""),a.amount(""),a.addDate(b,c),a.highlightPoints(),a.dateFocus(!0));return!1};a.timeAmount.subscribe(function(b){a.loading||a.storage.setTimeAmount(b)});a.timeUnit.subscribe(function(b){a.loading||a.storage.setTimeUnit(b)});a.rowMouseOver=function(b){a.unHighlightAllRows();a.highlight(b)&&a.highlightPoints(b)};a.mouseOut=function(){a.unHighlightAllRows();a.highlightPoints()};
a.waitingForAnimationToFinish=!1;a.nextMouseOver=function(){a.waitingForAnimationToFinish||(a.unHighlightAllRows(),a.highlight(a.nextRow)&&a.highlightPoints(a.nextRow))};a.highlight=function(a){return a.isToday||a.isSizeRow?!1:(a.isHighlighted(!0).matchingRow.isHighlighted(!0),!0)};a.unHighlightAllRows=function(){a.rows().forEach(function(a){a.isHighlighted(!1)})}}
PageViewModel.prototype.addDate=function(c,f,a){var b=new Date(c),e=Number(this.timeAmount());switch(this.timeUnit()){case "Days":b.setDate(b.getDate()+e);break;case "Months":b.setMonth(b.getMonth()+e);break;default:console.log("Failed to find time unit, defaulting to years");case "Years":b.setFullYear(b.getFullYear()+e)}c=new RowViewModel(c,f,!0,this.isSmall);f=new RowViewModel(b,new Currency(f),!1,this.isSmall);c.matchingRow=f;f.matchingRow=c;this.rows().push(c);this.rows().push(f);this.rows().sort(function(a,
b){return a.date.getTime()-b.date.getTime()});a||this.rows.valueHasMutated()};PageViewModel.prototype.loadTestData=function(){[["$7802.05","7/6/2012"],["$6931.49","2/1/2013"],["$7568.49","4/12/2013"],["$3802.00","1/6/2012"],["$3658.51","4/13/2012"],["$775.00","12/21/2012"],["$4350.00","6/28/2013"]].forEach(function(c){this.addDate(new Date(c[1]),new Currency(c[0]),!0)},this);this.waitingForAnimationToFinish=!0;this.rows.valueHasMutated();this.highlightPoints()};
PageViewModel.prototype.loadSavedData=function(){this.storage.getDates().forEach(function(c){this.addDate(new Date(c[1]),new Currency(c[0]),!0)},this);this.rows.valueHasMutated();this.loading=!1};PageViewModel.prototype.getStartRows=function(){return this.rows().filter(function(c){return c.isStart})};PageViewModel.prototype.animationFinished=function(){this.waitingForAnimationToFinish=!1};
