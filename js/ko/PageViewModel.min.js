function PageViewModel(c){var a=this;a.storage=c;a.date=ko.observable();a.dateError=ko.observable(!1);a.amount=ko.observable();a.amountError=ko.observable(!1);a.timeAmount=ko.observable(2);a.lastTimeAmount=1;a.timeUnit=ko.observable("Years");a.rows=ko.observableArray();a.isSmall=ko.observable(!1);a.daysLeft=ko.observable(0);a.nextRow=null;a.loading=!1;a.timeUnitOptions=["Days","Months","Years"];a.sizeRow=new RowViewModel(new Date(0),new Currency("0"),!1,a.isSmall,"SizeRow");a.todayRow=new RowViewModel(new Date,
new Currency("0"),!1,a.isSmall,"Today");a.rows.push(a.todayRow);a.timeAmountOptions=ko.computed(function(){var a=this.timeAmount(),d=0;switch(this.timeUnit()){case "Days":d=30;break;case "Months":d=12;break;case "Years":d=20;break;default:console.error("Failed to populate time amounts from unit: "+this.timeUnit());return}a>d&&(a=d);this.timeAmount(a);for(var a=[],c=1;c<=d;c++)a.push(c);return a},this);a.removePair=function(b){a.rows.remove(b);a.rows.remove(b.matchingRow)};a.rows.subscribe(function(b){var d=
new Currency("0");b.forEach(function(a){a.update(d)});a.loading||a.storage.setDates(b);b=a.rows.indexOf(a.todayRow);if(-1!==b&&b<a.rows().length-1){a.nextRow=a.rows()[b+1];b=util.stripTime(a.nextRow.date);var c=util.stripTime(a.todayRow.date);b=(b-c)/864E5;c=Math.floor(b);if(c!==b){var f=Math.ceil(b);b=f-b<b-c?f:c}a.daysLeft(b)}});a.updateDuration=function(){var b=[];a.rows().forEach(function(a){a.isStart&&b.push({date:a.date,amount:a.amount})});a.deleteAll();b.forEach(function(b){a.addDate(b.date,
b.amount)})};a.timeAmount.subscribe(a.updateDuration);a.timeUnit.subscribe(a.updateDuration);a.deleteAll=function(){a.rows.remove(function(a){return!a.isToday})};a.getInput=function(){console.log("getInput",this.date(),this.amount(),this.timeAmount(),this.timeUnit());var b=new Date(this.date()),c=new Currency(this.amount()),e=!0;c.valid||(e=!1);a.amountError(!c.valid);util.isInvalidDate(b)?(e=!1,a.dateError(!0)):a.dateError(!1);e&&(this.date(""),this.amount(""),this.addDate(b,c));return!1}}
PageViewModel.prototype.addDate=function(c,a){var b=new Date(c),d=Number(this.timeAmount());switch(this.timeUnit()){case "Days":b.setDate(b.getDate()+d);break;case "Months":b.setMonth(b.getMonth()+d);break;default:console.log("Failed to find time unit, defaulting to years");case "Years":b.setFullYear(b.getFullYear()+d)}d=new RowViewModel(c,a,!0,this.isSmall);b=new RowViewModel(b,new Currency(a),!1,this.isSmall);d.matchingRow=b;b.matchingRow=d;this.rows.push(d);this.rows.push(b);this.rows.sort(function(a,
b){return a.date.getTime()-b.date.getTime()})};PageViewModel.prototype.loadTestData=function(){[["$7802.05","7/6/2012"],["$6931.49","2/1/2013"],["$7568.49","4/12/2013"],["$3802.00","1/6/2012"],["$3658.51","4/13/2012"],["$775.00","12/21/2012"],["$4350.00","6/28/2013"]].forEach(function(c){this.addDate(new Date(c[1]),new Currency(c[0]))},this)};
PageViewModel.prototype.loadSavedData=function(){this.loading=!0;this.storage.getDates().forEach(function(c){this.addDate(new Date(c[1]),new Currency(c[0]))},this);this.loading=!1};PageViewModel.prototype.rowMouseOver=function(c){c.isToday||c.isSizeRow||c.isHighlighted(!0).matchingRow.isHighlighted(!0)};PageViewModel.prototype.rowMouseOut=function(c){c.isToday||c.isSizeRow||c.isHighlighted(!1).matchingRow.isHighlighted(!1)};
