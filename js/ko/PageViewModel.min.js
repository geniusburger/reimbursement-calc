function PageViewModel(d){var a=this;a.storage=d;a.date=ko.observable();a.dateError=ko.observable(!1);a.amount=ko.observable();a.amountError=ko.observable(!1);a.timeAmount=ko.observable(d.getTimeAmount()||2);a.lastTimeAmount=1;a.timeUnit=ko.observable(d.getTimeUnit()||"Years");a.rows=ko.observableArray();a.isSmall=ko.observable(!1);a.daysLeft=ko.observable(0);a.dateFocus=ko.observable(!0);a.amountFocus=ko.observable(!1);a.nextRow=null;a.loading=!1;a.timeUnitOptions=["Days","Months","Years"];a.sizeRow=
new RowViewModel(new Date(0),new Currency("0"),!1,a.isSmall,"SizeRow");a.todayRow=new RowViewModel(new Date,new Currency("0"),!1,a.isSmall,"Today");a.rows.push(a.todayRow);a.timeAmountOptions=ko.computed(function(){var a=this.timeUnit(),c=this.timeAmount.peek(),e=0;switch(a){case "Days":e=30;break;case "Months":e=12;break;case "Years":e=20;break;default:console.error("Failed to populate time amounts from unit: "+this.timeUnit());return}c>e&&(c=e);this.timeAmount(c);a=[];for(c=1;c<=e;c++)a.push(c);
return a},this);a.removePair=function(b){a.rows.remove(b);a.rows.remove(b.matchingRow)};a.rows.subscribe(function(b){var c=new Currency("0");b.forEach(function(a){a.update(c)});a.loading||a.storage.setDates(b);b=a.rows.indexOf(a.todayRow);if(-1!==b&&b<a.rows().length-1){a.nextRow=a.rows()[b+1];b=util.stripTime(a.nextRow.date);var e=util.stripTime(a.todayRow.date);b=(b-e)/864E5;e=Math.floor(b);if(e!==b){var d=Math.ceil(b);b=d-b<b-e?d:e}a.daysLeft(b)}});a.updateDuration=function(){var b=[];a.rows().forEach(function(a){a.isStart&&
b.push({date:a.date,amount:a.amount})});a.deleteAll();b.forEach(function(b){a.addDate(b.date,b.amount)})};a.timeAmount.subscribe(a.updateDuration);a.timeUnit.subscribe(a.updateDuration);a.deleteAll=function(){a.rows.remove(function(a){return!a.isToday})};a.getInput=function(){var b=new Date(a.date()),c=new Currency(a.amount()),e=!0;c.valid||(e=!1,a.amountFocus(!0));a.amountError(!c.valid);util.isInvalidDate(b)?(e=!1,a.dateError(!0),a.dateFocus(!0)):a.dateError(!1);e&&(a.date(""),a.amount(""),a.addDate(b,
c),a.dateFocus(!0));return!1};a.timeAmount.subscribe(function(b){a.storage.setTimeAmount(b)});a.timeUnit.subscribe(function(b){a.storage.setTimeUnit(b)});a.rowMouseOver=function(b){a.highlight(b,!0)};a.rowMouseOut=function(b){a.highlight(b,!1)};a.nextMouseOver=function(){a.highlight(a.nextRow,!0)};a.nextMouseOut=function(){a.highlight(a.nextRow,!1)};a.highlight=function(a,c){a.isToday||a.isSizeRow||a.isHighlighted(c).matchingRow.isHighlighted(c)}}
PageViewModel.prototype.addDate=function(d,a){var b=new Date(d),c=Number(this.timeAmount());switch(this.timeUnit()){case "Days":b.setDate(b.getDate()+c);break;case "Months":b.setMonth(b.getMonth()+c);break;default:console.log("Failed to find time unit, defaulting to years");case "Years":b.setFullYear(b.getFullYear()+c)}c=new RowViewModel(d,a,!0,this.isSmall);b=new RowViewModel(b,new Currency(a),!1,this.isSmall);c.matchingRow=b;b.matchingRow=c;this.rows.push(c);this.rows.push(b);this.rows.sort(function(a,
b){return a.date.getTime()-b.date.getTime()})};PageViewModel.prototype.loadTestData=function(){[["$7802.05","7/6/2012"],["$6931.49","2/1/2013"],["$7568.49","4/12/2013"],["$3802.00","1/6/2012"],["$3658.51","4/13/2012"],["$775.00","12/21/2012"],["$4350.00","6/28/2013"]].forEach(function(d){this.addDate(new Date(d[1]),new Currency(d[0]))},this)};
PageViewModel.prototype.loadSavedData=function(){this.loading=!0;this.storage.getDates().forEach(function(d){this.addDate(new Date(d[1]),new Currency(d[0]))},this);this.loading=!1};PageViewModel.prototype.getStartRows=function(){return this.rows().filter(function(d){return d.isStart})};
